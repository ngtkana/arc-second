# ARC 087 C - Good Sequence

個数の足りているものをすべて採用です。


# ARC 087 D - FT Robot

各 $F$ でどの方向に進めるのかを調べましょう。
$T$ で区切られた各区間で方向は等しい必要があります。
また、$T$ が偶数回あったあとでは方向は $x$ で、奇数回ならば $y$ です。
さらにはじめに $T$ に出会うまでは右にしか進めません。
逆にこれさえ満たしていればなんでも達成できます。

$x, y$ 方向の移動道のりをそれぞれ計算です。届いていなかったり偶奇が違ったらだめです。
次に、ある区間を逆にするごとにその $2$ 倍の量逆戻りになりますから、戻れる区間をすべて見て部分和問題をするとよいです。


# ARC 087 E - Prefix-free Game

## 概念パート

選べる場所の残りは常に完全二分木の非交叉和です。
（頂点の数ベースでの）高さが $i$ のものの Grundy 数を $a _ i$ としましょう。
ここから遷移できるのはこちらです。
$$
    \begin{alignedat}{1}
        & 0, \\
        & a _ { i - 1 }, \\
        & a _ { i - 1 } \oplus a _ { i - 2 }, \\
        & a _ { i - 1 } \oplus a _ { i - 2 } \oplus a _ { i - 3 } \\
        & \vdots \\
        & a _ { i - 1 } \oplus a _ { i - 2 } \oplus a _ { i - 3 } \oplus \dots \oplus a _ { 1 }
    \end{alignedat}
$$

手計算をがんばると、$a _ i = \max \left\{ 2 ^ j \middle \vert i \in 2 ^ j \mathbb Z \right\}$
であることが予想できますから、Grundy 数の条件をチェックです。

| $i$     | $1$ | $2$ | $3$ | $4$ | $5$ | $6$ | $7$ | $8$ | $9$ | $\cdots$ |
|-        |-    |-    |-    |-    |-    |-    |-    |-    |-    |-         |
| $a _ i$ | $1$ | $2$ | $1$ | $4$ | $1$ | $2$ | $1$ | $8$ | $1$ | $\cdots$ |


## 実装パート

トライを作って、文字列の終端があるところに印をつけておきましょう。
すると操作できる部分は、文字列の終端でない部分の、子がいないところですから、これを xor していき、AC です。


# ARC 087 F - Squirrel Migration

## 概念パート

移動距離の総和が最大になるのは、全員が木の重心を通ることと同値です。
特に、重心が辺なときには答えは $\left( \frac n 2 \right)! ^ 2$ です。
重心が頂点のときには、重心から生えている部分木すべての行き先が部分木の外であるような置換を数えると良いです。

## 数え上げパート

部分木が $X _ 0, X _ 1, \dots, X _ { k - 1 }$ であるとしましょう。
さらにそのサイズを $x _ 0, x _ 1, \dots, x _ { k - 1 }$ としましょう。
リスの集合 $I$ に対して、そのリスが部分木にとどまるような場合の数はこちらです。
$$
    a _ I = (n - \# I ) ! \cdot \prod _ { j = 0 } ^ { k - 1 } x _ j ^ { \underline { \# ( X _ j \cap I } ) }
$$

こたえはこちらです。
$$
    \mathtt{ ans }
    = \sum _ { I \subset [ n ] } ( -1 ) ^ { \# I } a _ I
    = \sum _ { I \subset [ n ] } ( -1 ) ^ { \# I } (n - \# I ) ! \cdot \prod _ { j = 0 } ^ { k - 1 } x _ j ^ { \underline { \# ( X _ j \cap I } ) }
$$

さらにこのように $\# I$ で分解です。
$$
    \mathtt{ ans }
     = \sum _ { i = 0 } ^ { n } ( -1 ) ^ i ( n - i ) ! \sum _ { I \in \binom { [ n ] } i } \prod _ { j = 0 } ^ { k - 1 } x _ j ^ { \underline { \# ( X _ j \cap I ) } }
$$

このうち、係数部分は後でかけることにして、$\prod \sum$ となっていることろを generating function で計算してしまいましょう。
すると、因数分解ができて、結局二項係数と下方階乗冪を掛け算すると良いことがわかりました。めでたしめでたしです。
$$
    \sum _ { i = 0 } ^ { n } \sum _ { I \in \binom { [ n ] } i } \prod _ { j = 0 } ^ { k - 1 } x _ j ^ { \underline { \# ( X _ j \cap I ) } } q ^ i
    = \prod _ { j = 0 } ^ { k - 1 } \sum _ { I \subset X _ j } x _ j ^ { \# I } q ^ { \# I }
    = \prod _ { j = 0 } ^ { k - 1 } \sum _ { i = 0 } ^ { x _ j - 1 } \binom { x _ j } { i } x _ j ^ { \underline { i } } q ^ { i }
$$

