## ARC 089 C - Traveling

移動時間が間に合って、かつ偶奇があえばよいです。


## ARC 089 D - Checker

すべての希望を $[0, k[ \times [0, k[$ に移してきます。パリティの合わないものは白黒を反転すると良いです。


得点は黒ゾーンにある $\mathrm B$ の数 + 白ゾーンにある $\mathrm W$ の数なのですが、これは次のようにも言い換えられます。
1. 黒ゾーンにある $\mathrm B$ の数 - 黒ゾーンにある $\mathrm W$ の数 + $\mathrm W$ の数
2. 白ゾーンにある $\mathrm W$ の数 - 白ゾーンにある $\mathrm B$ の数 + $\mathrm B$ の数

この長方形の色分けは $2 k ^ 2$ 通りありますが、
まずはそのうち半数である、黒正方形の左上が今見ている領域内にあるパターンを考えましょう。
すなわちこのような場合です。
```
##...
##...
..###
..###
..###
```


すると、$\mathrm B$ を $1$, $\mathrm W$ を $-1$ とした累積和をとって $g$ とおいておくと、
黒ゾーンにある $\mathrm B$ の数 - 黒ゾーンにある $\mathrm W$ の数はこのようにかくことができますから、方法 1 で計算ができます。
$$
    g _ { k, k } - g _ { i, k } - g _ { k , j } + 2 g _ { i , j }
$$

またもう半分である白正方形の左上が領域内にあるパターンは、累積和を取るときの重みの正負を入れ替えればよいです。
これの最大は、先程の符号を入れ替える前の最小を計算して、それの $-1$ 倍をするとよいです。



## ARC 089 E - GraphXY

$X$ を $k$ 回、$Y$ を $l$ 回通ってゴールするときの、数字が書いてある辺の重みだけを考えたときの最短経路長を $r _ {k, l}$ とおくと、与えられた $d _ { i, j }$ は次のようにかける必要があります。
$$
    d _ { i , j } = \min _ { k, l } \left ( i k + j l + r _ { k, l } \right ).
$$

これを満たすように $r _ { k, l }$ を決めていきましょう。各 $i, j$ に対して、$k, l, r$ を
$$
    \begin{array}{c}
        d _ { i, j }  = i k + j l + r, \\
        d _ { i ', j ' } \le i ' k + j ' l + r
    \end{array}
$$
を満たすように取ればよいです。これが取れなければ `"Impossible"` です。

これが取れた場合は、このような経路しかないようにグラフを作ればよいです。
これは、スタートから $\mathrm X$ な辺を直列に出ていて、
ゴールに向かって $Y$ な辺が直列に入っているようなグラフに、
適宜辺を追加していけばよいです。


## ARC 089 F - ColoringBalls

### 分解パート

最終形が与えられたとして、どのような文字列ならばそれが塗れるかを考えたいです。
白マスで分けた各成分の塗り方を考えます。これはまず赤で塗ります。これで終わりならばよくて、青色があるならば青色です。さらにここから赤でも青でもなにかをすることで、青色の連結成分を $1$ 増やすことができます。

まとめると、正規表現でこのようになります。

- 赤オンリー: $r$
- 青い連結成分が $k$ 個: ${rb}[{rb}]\{k-1\}$

### 判定パート

さて、これらが与えられた $s$ で達成可能かを判定です。左の $r$ から順に貪欲に割り当てていって、そのあとで $2$ 文字目の $b$ を左から順に貪欲に割り当てて行きます。

残りの文字は、左にあるものほど長いものをに割り当てる感じで行うのですが、 これははじめの $2$ 文字をマッチしていない文字の個数の後ろからの累積和をとっておくと判定ができます。


### 数え上げパート

まさかの全探索です。（まさかすぎませんか？）
列は $3 ^ N$ 通りあるのですが、パターンの多重集合が一致するものを纏めておきます。パターンの長さの多重集合を考えると、$35$ 弱の分割数くらいになり、$35$ の分割数は $14883$ なので案外少ないです。（案外少ないですね。）それぞれについて、先述の判定を行うとよいです。（判定が $\Theta \left ( N ^ 2 \right )$ でも間に合いそうな数字です。）

さて、あとはパターン多重集合が $(\lambda _ i) _ { i = 0 } ^ {k - 1}$ になるような列が実際にどれくらいあるかです。まずランレングス圧縮されたものを数えましょう。長さ $i$ のパターンで作れるもののランレングス圧縮は、こうです。まず長さ $1$ のときには $r$ のみです。$2$ 以上のときにはこの $4$ 通りです。

- $b(rb)\{i - 1\}$
- $b(rb)\{i - 1\}r$
- $rb(rb)\{i - 1\}$
- $rb(rb)\{i - 1\}r$

というわけで、パターン多重集合 $(\lambda _ i ) _ { i = 0 } ^ { k - 1 }$ の重複度列 $( m _ i ) _ { i = 0 } ^ \infty$ を考えると、このパターン多重集合から作られる長さ $d$ のランレングス圧縮された列の個数 $c ^ \lambda _ d$ は、次のようにかけます。
$$
    \begin{alignedat}{1}
    \sum _ { d = 0 } ^ \infty c ^ \lambda _ d q ^ d &=
        q ^ { m _ 0 }
        \prod _ { i = 1 } ^ \infty \left (
            q ^ { 2 i - 1 } + 2 q ^ { 2 i } + q ^ { 2 i + 1}
        \right) ^ { m _ i } \\

    &= q ^ { 2 \lvert \lambda \rvert - l \left ( \lambda \right) }
        \left ( 1 + q ^ 2 \right ) ^ { l \left ( \lambda \right) - m _ 0 } \\

    \therefore \ c ^ \lambda _ d &=
        \binom
            { l ( \lambda ) - m _ 0 }
            { \left (
                d -  2 \lvert \lambda \rvert - l \left ( \lambda \right )
         \right ) / 2 }
    \end{alignedat}
$$

また、長さ $i$ ランレングス圧縮があると、それになるような列の総数は、$n - 1$ 箇所ある間から仕切りを入れる場所を $i - 1$ 個選びますから、$\binom { n - 1 } { i - 1 }$ です。したがって、各実現可能パターン多重集合の答えへの寄与はこうです。
$$
    \sum _ { d = 0 } ^ \infty
        \binom
            { l ( \lambda ) - m _ 0 }
            { \left (
                d -  2 \lvert \lambda \rvert - l \left ( \lambda \right )
         \right ) / 2 }
         \binom { n - 1 } { d }
$$
（書くのが面倒なので省いてしまったのですが、$2$ で割るところが割り切れないような項は $0$ です。）


### 本質図鑑

長かったですから、まとめましょう。

1. 連結成分ごとにランレングス圧縮しましょう。
2. 白で分けましょう。
3. するとパターンでかけます。
4. パターンがわかれば、貪欲で判定ができます。
5. パターンの多重集合が少ないですから、全探索です。
6. それぞれの寄与は二項係数で頑張ればよいです。

1, 2 は見た瞬間にわかるもので、3 もいろいろ考えていると気づきます。4 はもう少し簡単な問題でよく見る典型です。6 は計算はとても大変なのですが、基本的にはやるだけです。

問題は 5 です。とても小さいけれど、いわゆる普通の全探索は絶望的、という制約でしたから、とても戸惑ったのですが、なるほどです。状態をまとめるとびっくりするくらい減ることがあるのですね。確かに纏め方自体はそこまで突拍子もなくはないのですが、まさかこんなに少なくなるとは思わずといった感じです。面白いです。
